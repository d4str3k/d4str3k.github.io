---
import FormattedDate from './FormattedDate.astro';

export interface Props {
  lab: {
    slug: string;
    data: {
      title: string;
      summary?: string;
      pubDate: Date;
      author?: string;
      tags?: string[];
      image?: string;
      externalLink?: string;
    };
  };
}

const { lab } = Astro.props;
const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : import.meta.env.BASE_URL + '/';
const labUrl = lab.data.externalLink || `${base}labs/${lab.slug}/`;
const isExternal = !!lab.data.externalLink;
---

<article class="post on-list">
  <h2 class="post-title">
    <a href={labUrl} target={isExternal ? "_blank" : undefined} rel={isExternal ? "noopener" : undefined}>
      {lab.data.title}
    </a>
  </h2>
  <div class="post-meta">
    <time class="post-date">
      <FormattedDate date={lab.data.pubDate} />
    </time>
    {lab.data.author && (
      <span class="post-author">{lab.data.author}</span>
    )}
  </div>
  {lab.data.tags && lab.data.tags.length > 0 && (
    <span class="post-tags">
      {lab.data.tags.map((tag, index) => (
        <>
          <a href={`${base}tags/${tag}/`}>{tag}</a>{index < lab.data.tags.length - 1 && ', '}
        </>
      ))}
    </span>
  )}
  {lab.data.image && (
    <figure class="post-cover">
      <img src={lab.data.image} alt={lab.data.title} />
    </figure>
  )}
  {lab.data.summary && (
    <div class="post-content">
      <p>{lab.data.summary}</p>
    </div>
  )}
  <div>
    <a href={labUrl} class="read-more button inline" target={isExternal ? "_blank" : undefined} rel={isExternal ? "noopener" : undefined}>
      [Read more]
    </a>
  </div>
</article>
