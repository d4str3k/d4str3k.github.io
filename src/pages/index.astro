---
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/PostCard.astro';
import LabCard from '../components/LabCard.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('posts'))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 2);

const labs = (await getCollection('labs'))
  .filter(lab => !lab.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 2);

const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : import.meta.env.BASE_URL + '/';
---

<BaseLayout title="d4str3k - Portfolio" description="Portfolio of d4str3k, showcasing projects and links to professional profiles.">
  <div class="index-content framed">
    <h1 id="hello-there">Welcome to my portfolio</h1>
    <p>Here you will find a collection of my projects as well as links to my profiles intended to showcase my work.</p>
    <p>
      You can find my projects <a href="https://d4str3k.github.io/projects/">here.</a>
    </p>
  </div>
  
  <div class="latest-labs">
    <h2 class="section-title">Latest Labs</h2>
    <div class="labs-list">
      {labs.map((lab) => {
        const slug = lab.id.replace(/^labs\//, '').replace(/\.md$/, '');
        return <LabCard lab={{ slug, data: lab.data }} />;
      })}
    </div>
    <a href={`${base}labs/`} class="view-all-link">View all labs →</a>
  </div>

  <div class="latest-posts">
    <h2 class="section-title">Latest Posts</h2>
    <div class="posts-list">
      {posts.map((post) => <PostCard post={post} />)}
    </div>
    <a href={`${base}posts/`} class="view-all-link">View all posts →</a>
  </div>
</BaseLayout>